# Compiler

试点班编译器

## TODOs

- [x] 寄存器分配（线性扫描）
- [x] 短路计算
- [x] ARM64
- [x] 控制流图(CFG)
- [ ] ...

## 优化

- [x] 常值计算
- [x] 短路计算优化
- [x ] 函数内联
- [x ] 分支剪枝
- [ x] 循环展开
- [x ] ...

## 短路计算实现

### 概述
短路计算（Short Circuit Evaluation）是逻辑运算的重要特性，确保在某些条件下不会计算所有操作数。

### 实现方式

#### 1. AST到IR转换阶段
在 `ir/Generator/IRGenerator.cpp` 中实现：

- **逻辑与 (&&)**: 在 `ir_and()` 方法中实现
  - 先计算左操作数
  - 如果左操作数为假，直接跳转到假分支
  - 否则继续计算右操作数

- **逻辑或 (||)**: 在 `ir_or()` 方法中实现
  - 先计算左操作数
  - 如果左操作数为真，直接跳转到真分支
  - 否则继续计算右操作数

#### 2. IR优化阶段
在 `ir/Function.cpp` 中实现：

- **短路计算优化** (`shortCircuitOptimization()`)
  - 检测常量条件跳转
  - 将条件跳转替换为无条件跳转

- **短路表达式优化** (`shortCircuitExpressionOptimization()`)
  - 优化常量关系表达式
  - 提前计算常量比较结果

### 测试用例

- `test/short_circuit_test.sy`: 基本短路计算测试
- `test/short_circuit_advanced_test.sy`: 高级短路计算测试

### 使用示例

```c
int main() {
    int a = 1, b = 0;
    
    // 短路计算：b不会被计算
    if (a && b) {
        // 不会执行
    }
    
    // 短路计算：c不会被计算
    if (a || c) {
        // 会执行
    }
    
    return 0;
}
```

### 优化效果

1. **性能提升**: 避免不必要的计算
2. **安全性**: 防止数组越界、空指针解引用等错误
3. **代码优化**: 在编译时进行短路优化
